var request = require('supertest'),
    express = require('express');

process.env.NODE_ENV = 'test';

var app = require('../app.js');
var _id = '';


describe('POST New Todo', function(){
  it('creates new todo and responds with json success message', function(done){
    request(app)
    .post('/api/todo')
    .set('Accept', 'application/json')
    .expect('Content-Type', /json/)
    .send({"todo": {"complete":true,"created":"2005-08-19T04:15:49.134Z","task":"Without the Chronicle and Bede's Historia ecclesiastica gentis Anglorum (the Ecclesiastical History of the English People), it would be impossible to write the history of the English from the Romans to the Norman Conquest."}})
    .expect(201)
    .end(function(err, res) {
      if (err) {
        throw err;
      }
      _id = res.body._id;
      done();
    });
  });
});

describe('GET List of Todos', function(){
  it('responds with a list of todo items in JSON', function(done){
    request(app)
    .get('/api/todos')
    .set('Accept', 'application/json')
    .expect('Content-Type', /json/)
    .expect(200, done);
  });
});

describe('GET Todo by ID', function(){
  it('responds with a single todo item in JSON', function(done){
    request(app)
    .get('/api/todo/'+ _id )
    .set('Accept', 'application/json')
    .expect('Content-Type', /json/)
    .expect(200, done);
  });
});


describe('PUT Todo by ID', function(){
  it('updates todo item in return JSON', function(done){
    request(app)
    .put('/api/todo/'+ _id )
    .set('Accept', 'application/json')
    .expect('Content-Type', /json/)
    .send({ "todo": { "title": "Hell Is Where There Are No Robots" } })    
    .expect(200, done);
  });
});

describe('DELETE Todo by ID', function(){
  it('should delete todo and return 200 status code', function(done){
    request(app)
    .del('/api/todo/'+ _id) 
    .expect(204, done);
  });
});